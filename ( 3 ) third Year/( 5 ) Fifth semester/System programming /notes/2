#!/usr/bin/env bash
set -euo pipefail

FONT_NAME="JetBrainsMono"
NERD_FONT_NAME="${FONT_NAME// /}"
FONT_DIR="$HOME/.local/share/fonts"
TMP_DIR="$(mktemp -d)"

echo "ðŸ§© Installing ${FONT_NAME} Nerd Font..."

# Get the actual zip URL from the latest GitHub release
ZIP_URL=$(curl -s https://api.github.com/repos/ryanoasis/nerd-fonts/releases/latest \
  | grep -Eo "https.*${NERD_FONT_NAME}\.zip" | head -n 1)

if [ -z "$ZIP_URL" ]; then
  echo "âŒ Could not find download link for ${FONT_NAME} Nerd Font."
  echo "Visit https://www.nerdfonts.com/font-downloads manually."
  exit 1
fi

echo "ðŸ“¦ Downloading from:"
echo "   $ZIP_URL"
curl -L -o "$TMP_DIR/${NERD_FONT_NAME}.zip" "$ZIP_URL"

echo "ðŸ“‚ Extracting to $FONT_DIR ..."
mkdir -p "$FONT_DIR"
unzip -o "$TMP_DIR/${NERD_FONT_NAME}.zip" -d "$FONT_DIR" > /dev/null

echo "ðŸ”„ Refreshing font cache..."
fc-cache -fv > /dev/null

echo "ðŸ§¹ Cleaning up..."
rm -rf "$TMP_DIR"

echo "âœ… ${FONT_NAME} Nerd Font installed successfully!"
echo
echo "ðŸ‘‰ Now set your terminal font to '${FONT_NAME} Nerd Font'."
echo "ðŸ§ª Test icons with:"
echo "   curl -s https://raw.githubusercontent.com/ryanoasis/nerd-fonts/master/bin/scripts/test-fonts.sh | bash"

